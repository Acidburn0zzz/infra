---
- include: logging.yml

- name: copy ipfs service unit definition
  template: src="ipfs.service.j2" dest="/etc/systemd/system/ipfs.service" force=yes
  notify:
    - "Restart_IPFS"


- name: build go-ipfs Docker image
  include_tasks:
    file: build.yml
    apply:
      delegate_to: localhost

- name: copy linux binary from Docker container
  shell: "/usr/local/bin/docker run -v /tmp/:/opt/mount --rm --entrypoint cp go-ipfs-ansible:{{ go_ipfs_version }} /usr/local/bin/ipfs /opt/mount/ipfs.{{ go_ipfs_version }}"
  args:
    creates: "/tmp/ipfs.{{ go_ipfs_version }}"
  delegate_to: localhost

- name: copy go-ipfs binary
  copy:
    src: "/tmp/ipfs.{{ go_ipfs_version }}"
    dest: /usr/local/bin/ipfs
    force: yes
  notify:
    - "Restart_IPFS"
